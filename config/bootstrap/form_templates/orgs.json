{
  "title": "Organizations",
  "name": "orgs",
  "path": "orgs",
  "type": "resource",
  "display": "form",
  "tags": ["Underwriting"],
  "access": [
    {
      "type": "read_all",
      "roles": ["authenticated", "programmer", "staff", "underwriting", "management", "administrator"]
    }
  ],
  "submissionAccess": [
    {
      "type": "read_all",
      "roles": ["authenticated", "programmer", "staff", "underwriting", "management", "administrator"]
    },
    {
      "type": "create_all",
      "roles": ["staff", "management", "administrator"]
    },
    {
      "type": "update_all",
      "roles": ["staff", "management", "administrator"]
    },
    {
      "type": "delete_all",
      "roles": ["management", "administrator"]
    }
  ],
  "settings": {
    "ui": {
      "alternateTitle": "Organizations",
      "submissionsTitle": "Organizations",
      "sortOrder": 2
    },
    "tabulatorList": {
      "enabled": true,
      "responsiveLayout": "hide",
      "columns": [
        {
          "field": "data.name",
          "title": "Name",
          "responsive": 0,
          "minWidth": 150,
          "headerFilter": "input"
        },
        {
          "field": "data.orgType",
          "title": "Type",
          "responsive": 1,
          "width": 120
        },
        {
          "field": "data.status",
          "title": "Status",
          "responsive": 1,
          "width": 100
        },
        {
          "field": "data.phone",
          "title": "Phone",
          "responsive": 2,
          "width": 120
        },
        {
          "field": "data.website",
          "title": "Website",
          "responsive": 3,
          "minWidth": 150
        }
      ]
    }
  },
  "components": [
    {
      "label": "Basic Information",
      "key": "basicInfo",
      "type": "panel",
      "input": false,
      "tableView": false,
      "components": [
        {
          "label": "Organization Name",
          "key": "name",
          "type": "textfield",
          "input": true,
          "tableView": true,
          "validate": {
            "required": true
          }
        },
        {
          "label": "Organization Type",
          "key": "orgType",
          "type": "select",
          "widget": "choicesjs",
          "input": true,
          "tableView": true,
          "dataSrc": "values",
          "data": {
            "values": [
              { "label": "Underwriter/Sponsor", "value": "underwriter" },
              { "label": "Community Partner", "value": "partner" },
              { "label": "Vendor/Supplier", "value": "vendor" },
              { "label": "Other", "value": "other" }
            ]
          },
          "defaultValue": "underwriter",
          "validate": {
            "required": true
          }
        },
        {
          "label": "Organization Tax Status",
          "key": "taxStatus",
          "type": "select",
          "widget": "choicesjs",
          "input": true,
          "tableView": true,
          "dataSrc": "values",
          "data": {
            "values": [
              { "label": "For-Profit", "value": "forprofit" },
              { "label": "Non-Profit", "value": "nonprofit" }
            ]
          }
        },
        {
          "label": "Non-Profit Type",
          "key": "nonprofitType",
          "type": "select",
          "widget": "choicesjs",
          "input": true,
          "tableView": true,
          "dataSrc": "values",
          "data": {
            "values": [
              { "label": "501(c)(3) — Charitable", "value": "501c3" },
              { "label": "501(c)(4) — Social Welfare", "value": "501c4" },
              { "label": "501(c)(6) — Business League", "value": "501c6" },
              { "label": "Other", "value": "other" }
            ]
          },
          "customConditional": "show = data.taxStatus === 'nonprofit';"
        },
        {
          "label": "Non-Profit Type (Other)",
          "key": "nonprofitTypeOther",
          "type": "textfield",
          "input": true,
          "tableView": false,
          "placeholder": "Enter non-profit type",
          "customConditional": "show = data.nonprofitType === 'other' && data.taxStatus === 'nonprofit';"
        },
        {
          "label": "Federal Tax ID (EIN)",
          "key": "ein",
          "type": "textfield",
          "input": true,
          "tableView": true,
          "inputMask": "99-9999999",
          "validate": {
            "pattern": "^\\d{2}-?\\d{7}$",
            "customMessage": "Please enter a valid 9-digit EIN (XX-XXXXXXX)",
            "custom": "const validPrefixes = ['01','02','03','04','05','06','10','11','12','13','14','15','16','20','21','22','23','24','25','26','27','30','31','32','33','34','35','36','37','38','39','40','41','42','43','44','45','46','47','48','50','51','52','53','54','55','56','57','58','59','60','61','62','63','64','65','66','67','68','71','72','73','74','75','76','77','80','81','82','83','84','85','86','87','88','90','91','92','93','94','95','98','99'];\nconst ein = input ? input.replace(/-/g, '') : '';\nif (ein.length === 0) { valid = true; } else if (ein.length !== 9 || !/^\\d{9}$/.test(ein)) { valid = 'Please enter a valid 9-digit EIN (XX-XXXXXXX)'; } else { const prefix = ein.substring(0, 2); valid = validPrefixes.includes(prefix) ? true : 'Invalid EIN prefix. Please check the number.'; }"
          }
        },
        {
          "label": "On-Air Name",
          "key": "onAirName",
          "type": "textfield",
          "input": true,
          "tableView": true,
          "description": "How to announce this organization on-air (if different from legal name)"
        },
        {
          "label": "Status",
          "key": "status",
          "type": "select",
          "widget": "choicesjs",
          "input": true,
          "tableView": true,
          "dataSrc": "values",
          "data": {
            "values": [
              { "label": "Prospect", "value": "prospect" },
              { "label": "Active", "value": "active" },
              { "label": "Inactive", "value": "inactive" },
              { "label": "Do Not Contact", "value": "do_not_contact" }
            ]
          },
          "defaultValue": "prospect"
        }
      ]
    },
    {
      "label": "Contact Information",
      "key": "contactInfo",
      "type": "panel",
      "input": false,
      "tableView": false,
      "components": [
        {
          "label": "Phone",
          "key": "phone",
          "type": "phoneNumber",
          "input": true,
          "tableView": true
        },
        {
          "label": "Website",
          "key": "website",
          "type": "url",
          "input": true,
          "tableView": true
        },
        {
          "label": "Physical Address",
          "key": "physicalAddress",
          "type": "textarea",
          "input": true,
          "tableView": false,
          "rows": 3
        }
      ]
    },
    {
      "label": "Billing Information",
      "key": "billingInfo",
      "type": "panel",
      "input": false,
      "tableView": false,
      "components": [
        {
          "label": "Billing Address",
          "key": "billingAddress",
          "type": "textarea",
          "input": true,
          "tableView": false,
          "rows": 3,
          "description": "Leave blank if same as physical address"
        },
        {
          "label": "Billing Email",
          "key": "billingEmail",
          "type": "email",
          "input": true,
          "tableView": true,
          "description": "Where to send invoices"
        },
        {
          "label": "Billing Contact Name",
          "key": "billingContactName",
          "type": "textfield",
          "input": true,
          "tableView": false
        }
      ]
    },
    {
      "label": "Internal Notes",
      "key": "notes",
      "type": "textarea",
      "editor": "ckeditor",
      "input": true,
      "inputFormat": "html",
      "tableView": false,
      "description": "Internal notes (not visible to organization)"
    },
    {
      "label": "Submit",
      "key": "submit",
      "type": "button",
      "action": "submit",
      "theme": "primary",
      "input": true
    }
  ]
}
