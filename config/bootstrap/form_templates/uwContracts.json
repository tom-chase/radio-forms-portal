{
  "title": "Underwriting Contracts",
  "name": "uwContracts",
  "path": "uwcontract",
  "type": "resource",
  "display": "form",
  "tags": ["Underwriting"],
  "access": [
    {
      "type": "read_all",
      "roles": ["programmer", "staff", "underwriting", "management", "administrator"]
    }
  ],
  "submissionAccess": [
    {
      "type": "read_all",
      "roles": ["programmer", "staff", "underwriting", "management", "administrator"]
    },
    {
      "type": "create_all",
      "roles": ["underwriting", "management", "administrator"]
    },
    {
      "type": "update_all",
      "roles": ["underwriting", "management", "administrator"]
    },
    {
      "type": "delete_all",
      "roles": ["underwriting", "management", "administrator"]
    }
  ],
  "settings": {
    "ui": {
      "alternateTitle": "Contracts",
      "submissionsTitle": "Underwriting Contracts List",
      "sortOrder": 3
    },
    "tabulatorList": {
      "enabled": true,
      "responsiveLayout": "hide",
      "columns": [
        {
          "field": "data.status",
          "title": "Status",
          "responsive": 1,
          "width": 100
        },
        {
          "field": "data.contractName",
          "title": "Contract",
          "responsive": 0,
          "minWidth": 150,
          "headerFilter": "input"
        },
        {
          "field": "data.organization.data.name",
          "title": "Sponsor",
          "responsive": 0,
          "minWidth": 150
        },
        {
          "field": "data.totalValue",
          "title": "Value",
          "responsive": 1,
          "width": 100,
          "formatter": "money",
          "formatterParams": {
            "decimal": ".",
            "thousand": ",",
            "symbol": "$",
            "precision": 2
          }
        },
        {
          "field": "data.endDate",
          "title": "End Date",
          "responsive": 2,
          "width": 120,
          "formatter": "datetime",
          "formatterParams": {
            "inputFormat": "iso",
            "outputFormat": "MMM d, yyyy"
          }
        }
      ]
    }
  },
  "components": [
    {
      "label": "Contract Information",
      "key": "contractInfo",
      "type": "panel",
      "input": false,
      "tableView": false,
      "components": [
        {
          "label": "Contract Name",
          "key": "contractName",
          "type": "textfield",
          "input": true,
          "tableView": true,
          "validate": {
            "required": true
          }
        },
        {
          "label": "Organization",
          "key": "organization",
          "type": "select",
          "widget": "choicesjs",
          "input": true,
          "tableView": true,
          "dataSrc": "resource",
          "data": {
            "resource": "orgs"
          },
          "valueProperty": "_id",
          "template": "<span>{{ item.data.name }}</span>",
          "searchEnabled": true,
          "validate": {
            "required": true
          },
          "addResource": true,
          "reference": true
        },
        {
          "label": "Primary Contact",
          "key": "primaryContact",
          "type": "select",
          "widget": "choicesjs",
          "input": true,
          "tableView": true,
          "dataSrc": "resource",
          "data": {
            "resource": "contact"
          },
          "valueProperty": "_id",
          "template": "<span>{{ item.data.firstName }} {{ item.data.lastName }}</span>",
          "searchEnabled": true,
          "addResource": true,
          "reference": true
        }
      ]
    },
    {
      "label": "Contract Period",
      "key": "contractPeriod",
      "type": "panel",
      "input": false,
      "tableView": false,
      "components": [
        {
          "label": "Start Date",
          "key": "startDate",
          "type": "datetime",
          "input": true,
          "tableView": true,
          "enableTime": false,
          "format": "yyyy-MM-dd",
          "validate": {
            "required": true
          }
        },
        {
          "label": "End Date",
          "key": "endDate",
          "type": "datetime",
          "input": true,
          "tableView": true,
          "enableTime": false,
          "format": "yyyy-MM-dd",
          "validate": {
            "required": true
          }
        }
      ]
    },
    {
      "label": "Financial Details",
      "key": "financialDetails",
      "type": "panel",
      "input": false,
      "tableView": false,
      "components": [
        {
          "label": "Total Value (USD)",
          "key": "totalValue",
          "type": "number",
          "input": true,
          "tableView": true,
          "delimiter": true,
          "requireDecimal": true,
          "validate": {
            "min": 0
          }
        },
        {
          "label": "Billing Frequency",
          "key": "billingFrequency",
          "type": "select",
          "widget": "choicesjs",
          "input": true,
          "tableView": true,
          "dataSrc": "values",
          "data": {
            "values": [
              { "label": "One-time", "value": "one_time" },
              { "label": "Monthly", "value": "monthly" },
              { "label": "Quarterly", "value": "quarterly" },
              { "label": "Custom", "value": "custom" }
            ]
          }
        },
        {
          "label": "Billing Notes",
          "key": "billingNotes",
          "type": "textarea",
          "input": true,
          "tableView": false,
          "rows": 3,
          "description": "Payment schedule, terms, special arrangements"
        }
      ]
    },
    {
      "label": "Copy & Messaging",
      "key": "copyMessaging",
      "type": "panel",
      "input": false,
      "tableView": false,
      "components": [
        {
          "label": "Copy Summary",
          "key": "copySummary",
          "type": "textarea",
          "editor": "ckeditor",
          "input": true,
          "inputFormat": "html",
          "tableView": false,
          "description": "Overview of messaging, key points to include"
        }
      ]
    },
    {
      "label": "Attachments",
      "key": "attachments",
      "type": "datagrid",
      "input": true,
      "tableView": false,
      "reorder": true,
      "components": [
        {
          "label": "File Name",
          "key": "fileName",
          "type": "textfield",
          "input": true,
          "tableView": true
        },
        {
          "label": "File URL",
          "key": "fileUrl",
          "type": "url",
          "input": true,
          "tableView": true
        },
        {
          "label": "Description",
          "key": "description",
          "type": "textfield",
          "input": true,
          "tableView": false
        }
      ]
    },
    {
      "label": "Approval Workflow",
      "key": "approvalWorkflow",
      "type": "panel",
      "input": false,
      "tableView": false,
      "components": [
        {
          "label": "Status",
          "key": "status",
          "type": "select",
          "widget": "choicesjs",
          "input": true,
          "tableView": true,
          "dataSrc": "values",
          "data": {
            "values": [
              { "label": "Draft", "value": "draft" },
              { "label": "Pending Approval", "value": "pending" },
              { "label": "Active", "value": "active" },
              { "label": "Expired", "value": "expired" },
              { "label": "Cancelled", "value": "cancelled" }
            ]
          },
          "defaultValue": "draft"
        },
        {
          "label": "Program Manager Approval",
          "key": "programManagerApproval",
          "type": "container",
          "input": false,
          "tableView": false,
          "components": [
            {
              "label": "Approved",
              "key": "programManagerApproved",
              "type": "checkbox",
              "input": true,
              "tableView": true
            },
            {
              "label": "Approver",
              "key": "programManagerApprover",
              "type": "select",
              "widget": "choicesjs",
              "input": true,
              "tableView": false,
              "dataSrc": "resource",
              "data": {
                "resource": "user"
              },
              "valueProperty": "_id",
              "template": "<span>{{ item.data.email }}</span>",
              "searchEnabled": true,
              "reference": true,
              "conditional": {
                "show": true,
                "when": "programManagerApproved",
                "eq": true
              }
            },
            {
              "label": "Approval Date",
              "key": "programManagerApprovalDate",
              "type": "datetime",
              "input": true,
              "tableView": false,
              "enableTime": true,
              "format": "yyyy-MM-dd HH:mm",
              "conditional": {
                "show": true,
                "when": "programManagerApproved",
                "eq": true
              }
            }
          ]
        },
        {
          "label": "General Manager Approval",
          "key": "generalManagerApproval",
          "type": "container",
          "input": false,
          "tableView": false,
          "components": [
            {
              "label": "Approved",
              "key": "generalManagerApproved",
              "type": "checkbox",
              "input": true,
              "tableView": true
            },
            {
              "label": "Approver",
              "key": "generalManagerApprover",
              "type": "select",
              "widget": "choicesjs",
              "input": true,
              "tableView": false,
              "dataSrc": "resource",
              "data": {
                "resource": "user"
              },
              "valueProperty": "_id",
              "template": "<span>{{ item.data.email }}</span>",
              "searchEnabled": true,
              "reference": true,
              "conditional": {
                "show": true,
                "when": "generalManagerApproved",
                "eq": true
              }
            },
            {
              "label": "Approval Date",
              "key": "generalManagerApprovalDate",
              "type": "datetime",
              "input": true,
              "tableView": false,
              "enableTime": true,
              "format": "yyyy-MM-dd HH:mm",
              "conditional": {
                "show": true,
                "when": "generalManagerApproved",
                "eq": true
              }
            }
          ]
        },
        {
          "label": "Compliance Officer Approval",
          "key": "complianceOfficerApproval",
          "type": "container",
          "input": false,
          "tableView": false,
          "components": [
            {
              "label": "Approved",
              "key": "complianceOfficerApproved",
              "type": "checkbox",
              "input": true,
              "tableView": true
            },
            {
              "label": "Approver",
              "key": "complianceOfficerApprover",
              "type": "select",
              "widget": "choicesjs",
              "input": true,
              "tableView": false,
              "dataSrc": "resource",
              "data": {
                "resource": "user"
              },
              "valueProperty": "_id",
              "template": "<span>{{ item.data.email }}</span>",
              "searchEnabled": true,
              "reference": true,
              "conditional": {
                "show": true,
                "when": "complianceOfficerApproved",
                "eq": true
              }
            },
            {
              "label": "Approval Date",
              "key": "complianceOfficerApprovalDate",
              "type": "datetime",
              "input": true,
              "tableView": false,
              "enableTime": true,
              "format": "yyyy-MM-dd HH:mm",
              "conditional": {
                "show": true,
                "when": "complianceOfficerApproved",
                "eq": true
              }
            }
          ]
        }
      ]
    },
    {
      "label": "Internal Notes",
      "key": "notes",
      "type": "textarea",
      "editor": "ckeditor",
      "input": true,
      "inputFormat": "html",
      "tableView": false
    },
    {
      "label": "Submit",
      "key": "submit",
      "type": "button",
      "action": "submit",
      "theme": "primary",
      "input": true
    }
  ]
}
