{
  "title": "Contact",
  "name": "contact",
  "path": "contact",
  "type": "resource",
  "display": "form",
  "tags": [
    "General"
  ],
  "access": [
    {
      "type": "read_all",
      "roles": [
        "authenticated",
        "staff",
        "management",
        "administrator"
      ]
    }
  ],
  "submissionAccess": [
    {
      "type": "read_all",
      "roles": [
        "authenticated",
        "staff",
        "management",
        "administrator"
      ]
    },
    {
      "type": "create_all",
      "roles": [
        "authenticated",
        "staff",
        "management",
        "administrator"
      ]
    },
    {
      "type": "update_own",
      "roles": [
        "authenticated",
        "staff",
        "management",
        "administrator"
      ]
    },
    {
      "type": "delete_own",
      "roles": [
        "authenticated",
        "staff",
        "management",
        "administrator"
      ]
    },
    {
      "type": "update_all",
      "roles": [
        "management",
        "administrator"
      ]
    },
    {
      "type": "delete_all",
      "roles": [
        "management",
        "administrator"
      ]
    }
  ],
  "components": [
    {
      "label": "First Name",
      "key": "firstName",
      "type": "textfield",
      "input": true,
      "tableView": true,
      "validate": {
        "required": true
      }
    },
    {
      "label": "Last Name",
      "key": "lastName",
      "type": "textfield",
      "input": true,
      "tableView": true,
      "validate": {
        "required": true
      }
    },
    {
      "label": "Email",
      "key": "email",
      "type": "email",
      "input": true,
      "tableView": true
    },
    {
      "label": "Phone",
      "key": "phone",
      "type": "phoneNumber",
      "input": true,
      "tableView": true
    },
    {
      "label": "Organization",
      "key": "organization",
      "type": "select",
      "widget": "choicesjs",
      "input": true,
      "tableView": true,
      "dataSrc": "resource",
      "data": {
        "resource": "organization"
      },
      "valueProperty": "_id",
      "template": "<span>{{ item.data.name }}</span>",
      "searchEnabled": true,
      "description": "Link to organization record",
      "addResource": true,
      "reference": true
    },
    {
      "label": "Role / Title at Organization",
      "key": "roleAtOrg",
      "type": "textfield",
      "input": true,
      "tableView": true
    },
    {
      "label": "Contact Type",
      "key": "contactType",
      "type": "selectboxes",
      "input": true,
      "tableView": false,
      "values": [
        {
          "label": "Sponsor Contact",
          "value": "sponsor"
        },
        {
          "label": "Member/Donor",
          "value": "member"
        },
        {
          "label": "Community Partner",
          "value": "partner"
        },
        {
          "label": "Vendor",
          "value": "vendor"
        },
        {
          "label": "Volunteer Prospect",
          "value": "volunteer"
        },
        {
          "label": "Other",
          "value": "other"
        }
      ],
      "defaultValue": {
        "sponsor": true
      }
    },
    {
      "label": "Status",
      "key": "status",
      "type": "select",
      "widget": "choicesjs",
      "input": true,
      "tableView": true,
      "dataSrc": "values",
      "data": {
        "values": [
          {
            "label": "Active",
            "value": "active"
          },
          {
            "label": "Pending Review",
            "value": "pending_review"
          },
          {
            "label": "Inactive",
            "value": "inactive"
          }
        ]
      },
      "defaultValue": "active"
    },
    {
      "label": "Source",
      "key": "source",
      "type": "select",
      "widget": "choicesjs",
      "input": true,
      "tableView": true,
      "dataSrc": "values",
      "data": {
        "values": [
          {
            "label": "Website",
            "value": "website"
          },
          {
            "label": "Referral",
            "value": "referral"
          },
          {
            "label": "Event",
            "value": "event"
          },
          {
            "label": "Cold Call",
            "value": "cold_call"
          },
          {
            "label": "Other",
            "value": "other"
          }
        ]
      }
    },
    {
      "label": "Linked Portal User (optional)",
      "key": "linkedUser",
      "type": "select",
      "widget": "choicesjs",
      "input": true,
      "tableView": false,
      "dataSrc": "resource",
      "data": {
        "resource": "user"
      },
      "valueProperty": "_id",
      "template": "<span>{{ item.data.email }}</span>",
      "searchEnabled": true,
      "description": "If this contact has a portal login, link it here",
      "reference": true
    },
    {
      "label": "Donation History",
      "key": "donationHistory",
      "type": "panel",
      "input": false,
      "tableView": false,
      "customConditional": "show = data.contactType && data.contactType.member === true;",
      "components": [
        {
          "label": "Giving History",
          "key": "givingHistory",
          "type": "datagrid",
          "input": true,
          "tableView": false,
          "reorder": true,
          "components": [
            {
              "label": "Date",
              "key": "donationDate",
              "type": "datetime",
              "input": true,
              "tableView": true,
              "enableTime": false,
              "format": "yyyy-MM-dd",
              "validate": {
                "required": true
              }
            },
            {
              "label": "Amount (USD)",
              "key": "amount",
              "type": "number",
              "input": true,
              "tableView": true,
              "delimiter": true,
              "requireDecimal": true,
              "validate": {
                "required": true,
                "min": 0
              }
            },
            {
              "label": "Campaign/Fund",
              "key": "campaign",
              "type": "textfield",
              "input": true,
              "tableView": true
            },
            {
              "label": "Payment Method",
              "key": "paymentMethod",
              "type": "select",
              "widget": "choicesjs",
              "input": true,
              "tableView": true,
              "dataSrc": "values",
              "data": {
                "values": [
                  {
                    "label": "Cash",
                    "value": "cash"
                  },
                  {
                    "label": "Check",
                    "value": "check"
                  },
                  {
                    "label": "Credit Card",
                    "value": "credit_card"
                  },
                  {
                    "label": "Online",
                    "value": "online"
                  },
                  {
                    "label": "Other",
                    "value": "other"
                  }
                ]
              }
            },
            {
              "label": "Notes",
              "key": "donationNotes",
              "type": "textfield",
              "input": true,
              "tableView": false
            }
          ]
        },
        {
          "label": "Major Donor (365 days)",
          "key": "majorDonor",
          "type": "checkbox",
          "input": true,
          "tableView": true,
          "disabled": true,
          "description": "Automatically calculated: donations over $1,000 in past 365 days",
          "calculateValue": "value = (function() {\n  const history = data.givingHistory || [];\n  const now = new Date();\n  const oneYearAgo = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);\n  const recentTotal = history.reduce((sum, donation) => {\n    const donationDate = new Date(donation.donationDate);\n    if (donationDate >= oneYearAgo && donationDate <= now) {\n      return sum + (parseFloat(donation.amount) || 0);\n    }\n    return sum;\n  }, 0);\n  return recentTotal >= 1000;\n})();"
        }
      ]
    },
    {
      "label": "Notes",
      "key": "notes",
      "type": "textarea",
      "editor": "ckeditor",
      "input": true,
      "inputFormat": "html",
      "tableView": false,
      "description": "Internal notes"
    },
    {
      "title": "Share Settings",
      "theme": "primary",
      "collapsible": true,
      "collapsed": true,
      "key": "shareSettings",
      "type": "panel",
      "label": "Share Settings",
      "input": false,
      "tableView": false,
      "persistent": false,
      "clearOnHide": false,
      "components": [
        {
          "label": "Share with Public",
          "key": "sharePublic",
          "type": "checkbox",
          "input": true,
          "defaultValue": false,
          "labelPosition": "right",
          "tableView": true,
          "persistent": true,
          "id": "contact_sharepub"
        },
        {
          "label": "Share with Roles",
          "widget": "choicesjs",
          "tableView": true,
          "multiple": true,
          "dataSrc": "values",
          "data": {
            "values": [
              {
                "label": "Administrator",
                "value": "administrator"
              },
              {
                "label": "Management",
                "value": "management"
              },
              {
                "label": "Staff",
                "value": "staff"
              }
            ]
          },
          "template": "<span>{{ item.label }}</span>",
          "valueProperty": "value",
          "key": "shareRoles",
          "type": "select",
          "input": true,
          "persistent": true,
          "searchEnabled": true,
          "id": "contact_shareroles"
        },
        {
          "label": "Share with Departments",
          "widget": "choicesjs",
          "tableView": true,
          "multiple": true,
          "dataSrc": "resource",
          "data": {
            "resource": "department"
          },
          "valueProperty": "_id",
          "dataType": "resource",
          "template": "<span>{{ item.data.name }}</span>",
          "key": "shareDepartments",
          "type": "select",
          "input": true,
          "persistent": true,
          "searchEnabled": true,
          "authenticate": true,
          "id": "contact_sharedepts"
        },
        {
          "label": "Share with Committees",
          "widget": "choicesjs",
          "tableView": true,
          "multiple": true,
          "dataSrc": "resource",
          "data": {
            "resource": "committee"
          },
          "valueProperty": "_id",
          "dataType": "resource",
          "template": "<span>{{ item.data.name }}</span>",
          "key": "shareCommittees",
          "type": "select",
          "input": true,
          "persistent": true,
          "searchEnabled": true,
          "authenticate": true,
          "id": "contact_sharecomms"
        },
        {
          "label": "Share with Users",
          "widget": "choicesjs",
          "tableView": true,
          "multiple": true,
          "dataSrc": "resource",
          "data": {
            "resource": "user"
          },
          "valueProperty": "_id",
          "dataType": "resource",
          "template": "<span>{{ item.data.email }}</span>",
          "key": "shareUsers",
          "type": "select",
          "input": true,
          "persistent": true,
          "searchEnabled": true,
          "authenticate": true,
          "lazyLoad": true,
          "id": "contact_shareusers"
        }
      ]
    },
    {
      "label": "Submit",
      "key": "submit",
      "type": "button",
      "action": "submit",
      "theme": "primary",
      "input": true
    }
  ],
  "settings": {
    "ui": {
      "alternateTitle": "Contacts",
      "submissionsTitle": "Contacts"
    },
    "tabulatorList": {
      "enabled": true,
      "responsiveLayout": "hide",
      "layout": "fitColumns",
      "height": "60vh",
      "pagination": "local",
      "paginationSize": 25,
      "movableColumns": true,
      "placeholder": "No contacts found.",
      "columns": [
        {
          "title": "First",
          "field": "data.firstName",
          "headerFilter": "input",
          "responsive": 0,
          "minWidth": 100
        },
        {
          "title": "Last",
          "field": "data.lastName",
          "headerFilter": "input",
          "responsive": 0,
          "minWidth": 100
        },
        {
          "title": "Email",
          "field": "data.email",
          "headerFilter": "input",
          "responsive": 1,
          "minWidth": 150
        },
        {
          "title": "Org",
          "field": "data.organization.data.name",
          "responsive": 1,
          "width": 150
        },
        {
          "title": "Status",
          "field": "data.status",
          "responsive": 2,
          "width": 100
        }
      ]
    },
    "saveDraft": true,
    "saveDraftThrottle": 3000
  }
}