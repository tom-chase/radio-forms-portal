---
trigger: always_on
---
# Production Stability — Hardcoded Config Pattern

## Why
Dynamic environment variable substitution in Caddy and frontend config proved unstable during production deployments. Production config files are now **generated on the server** from the server's `.env` during deployment.

## MUST
- The deploy script (`scripts/deploy-production.sh`) **excludes** `app/config.js` and `config/env/production.json` from the tarball and regenerates them on the server.
- When changing domains or emails, update:
  1. `Caddyfile` (on the production server): email and domain blocks.
  2. Server `.env`: `SPA_DOMAIN`, `API_DOMAIN`, and related variables.
  3. `app/js/config.js`: fallback `API_BASE` and `SPA_ORIGIN` (for local dev only).
  4. `formio-config.json.template`: `trust proxy` stays `true`.

## MUST NOT
- Never revert to dynamic env-var substitution for production configs without explicit user instruction.
- Never manually edit `app/config.js` or `config/env/production.json` on the production server — they are generated by the deploy script.
